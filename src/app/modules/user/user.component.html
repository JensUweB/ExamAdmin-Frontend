<div class="container">
  <div class="row">
    <div class="col-md-12">
      <h1 i18n>My Profile</h1>
    </div>
  </div>
  <div class="row">
    <div class="col-6">
      <h3 i18n>Personal data:</h3>
      <form>
        <div class="row">
          <div class="col-sm">
            <form [formGroup]="userForm">
              <div class="row">
                <div class="col-sm">
                  <label for="firstName" i18n>First Name:</label>
                </div>
                <div class="col-sm">
                  <input class="form-control" type="text" formControlName="firstName">
                </div>
              </div>
              <div class="row">
                <div class="col-sm">
                  <label for="lastName" i18n>Last Name:</label>
                </div>
                <div class="col-sm">
                  <input class="form-control" type="text" formControlName="lastName">
                </div>
              </div>
              <div class="row">
                <div class="col-sm">
                  <label for="email" i18n>E-Mail:</label>
                </div>
                <div class="col-sm">
                  <input class="form-control" type="text" formControlName="email">
                </div>
              </div>
              <div class="row">
                <div class="col-sm">
                  <label for="oldPassword" i18n>Old Password:</label>
                </div>
                <div class="col-sm">
                  <input class="form-control" type="password" i18n-placeholder placeholder="your current password" formControlName="password"
                    name="oldPassword">
                </div>
              </div>
              <div class="row">
                <div class="col-sm">
                  <label for="newPassword" i18n>New Password:</label>
                </div>
                <div class="col-sm">
                  <input class="form-control" type="password" i18n-placeholder placeholder="new password" formControlName="newPassword">
                </div>
              </div>
              <div class="row">
                <div class="col-sm">
                  <label for="repeatPassword" i18n>Repeat Password:</label>
                </div>
                <div class="col-sm">
                  <input class="form-control" type="password" i18n-placeholder placeholder="confirm new password" formControlName="newPassword2">
                </div>
              </div>
              <div class="row">
                <div class="col-sm">
                  <button  mat-raised-button color="primary" class="mat-btn" (click)="onUserUpdate()"><mat-icon>update</mat-icon> Update</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </form>
    </div>
    <div class="col-6">
      <!--div class="row">
        <div class="col-8">
          <h4 i18n>Your Clubs:</h4>
        </div>
        <div class="col-4">
          <button type="button" class="btn btn-sm btn-success" (click)="openPopup(clubPopup)">Add</button>
        </div>
      </div>
      <div class="row" *ngFor="let club of user.clubs">
        <div class="col-sm">
          <a href="/user/#">{{club.club.name}}</a>
        </div>
      </div>
      <hr-->
      <div class="row">
        <div class="col-8">
          <h4 i18n>Your Martial Arts:</h4>
        </div>
        <div class="col-4">
          <button  mat-icon-button color="primary" class="mat-btn-primary" aria-label="Add a martial art to your profile" (click)="openPopup(maPopup)">
            <mat-icon>add_circle</mat-icon>
          </button>
        </div>
      </div>
      <div *ngFor="let martialArt of user.martialArts" class="row">
        <div class="col-8">
          <a class="link" (click)="showMaDetails(martialArt._id)">{{martialArt._id.styleName}} {{martialArt._id.name}}</a>
        </div>
        <div class="col-4">
          <b>{{martialArt._id.ranks[0].name}}</b>
        </div>
      </div>
    </div>
  </div>
  <br>
  <div class="row" *ngIf="alerts">
    <div class="col">
      <ngb-alert [dismissible]="true" [type]="alert.type" *ngFor="let alert of alerts" (close)="close(alert)">
        <p><strong>{{alert.message}}</strong></p>
      </ngb-alert>
    </div>
  </div>
  <br>
  <br>
  <div class="row">
    <div class="col">
      <h4 i18n>Exam Results:</h4>
    </div>
  </div>
  <div class="row">
    <div class="col" *ngIf="examResults.length">
      <div class="mat-elevation-z8">
        <table mat-table [dataSource]="examResults" class="full-width">
            <!-- Name Column -->
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef i18n> Martial Art</th>
                <td mat-cell *matCellDef="let result"> {{result.martialArt.styleName}} {{result.martialArt.name}} </td>
            </ng-container>

            <!-- Rank Column -->
            <ng-container matColumnDef="rank">
                <th mat-header-cell *matHeaderCellDef i18n>Rank</th>
                <td mat-cell *matCellDef="let result">{{result.rank}}</td>
            </ng-container>

            <!-- Passed Column -->
            <ng-container matColumnDef="result">
                <th mat-header-cell *matHeaderCellDef i18n>Passed</th>
                <td mat-cell *matCellDef="let result">
                  <div *ngIf="result.passed" i18n>passed</div>
                  <div *ngIf="!result.passed" i18n>failed</div>
                </td>
            </ng-container>

            <!-- Date Column -->
            <ng-container matColumnDef="date">
                <th mat-header-cell *matHeaderCellDef i18n>Date</th>
                <td mat-cell *matCellDef="let result">{{result.date}}</td>
            </ng-container>

            <!-- Protocol Column -->
            <ng-container matColumnDef="file">
              <th mat-header-cell *matHeaderCellDef i18n>Protocol</th>
              <td mat-cell *matCellDef="let result"><a mat-raised-button color="primary" class="mat-btn" (click)="downloadFile(result.reportUri, null)" i18n><mat-icon>cloud_download</mat-icon> download</a></td>
          </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let result; columns: displayedColumns;"></tr>
        </table>
        <mat-paginator #paginator
            [length]="examResults?.length"
            [pageIndex]="0"
            [pageSize]="10"
            [pageSizeOptions]="[10, 25, 50, 100]">
        </mat-paginator>
      </div>
    </div>
    <div class="col" *ngIf="!examResults.length">
      <b i18n>Sorry, but you don't have any exam results yet!</b>
    </div>
  </div>
</div>

<!-- Popup form for adding a new club to the user profile -->
<ng-template #clubPopup let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title" i18n>Add a Club</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <p i18n>Hello, {{user.firstName}}!<br>
      Here you can add a new club to your profile, if you want!</p>
    <form [formGroup]="clubForm">
      <div class="form-group">
        <label i18n>Club list</label>
        <select class="form-control" formControlName="clubId">
          <option *ngFor="let club of clubs" [value]="club._id">{{club.name}}</option>
        </select>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button mat-raised-button color="primary" class="mat-btn" (click)="onClubSubmit(); c('Save click')" i18n>Add Club</button>
  </div>
</ng-template>

<!-- A popup form for adding a new martial art to the user profile -->
<ng-template #maPopup let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title" i18n>Add a Martial Art</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <p i18n>Hello, {{user.firstName}}!<br>
      Here you can add a new martial art to your profile, if you want!</p>
    <form [formGroup]="maForm">
      <select class="form-control" formControlName="maId">
        <option *ngFor="let ma of martialArts; let i = index" [value]="i">{{ma.styleName}} {{ma.name}}</option>
      </select>
      <select *ngIf="maId.value" class="form-control" formControlName="rankId">
        <option *ngFor="let rank of martialArts[maId.value].ranks" [value]="rank._id">{{rank.name}}</option>
      </select>
    </form>
  </div>
  <div class="modal-footer">
    <button mat-raised-button color="primary" class="mat-btn" (click)="onMaSubmit(); c('Save click')" i18n>Add Martial Art</button>
  </div>
</ng-template>